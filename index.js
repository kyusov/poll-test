const token = ''

const { Telegraf, Scenes, session } = require('telegraf')
const User = require('./db')
const { s3, s2, s1, s4, s5, s6, s7, s8, s9, s10, s11 } = require('./scenes')

const bot = new Telegraf(token)

const stage = new Scenes.Stage([s1(), s2(), s3(), s4(), s5(), s6(), s7(), s8(), s9(), s10(), s11()])
bot.use(session())
bot.use(stage.middleware())

bot.start((ctx) => {
    User.findOne({ where: { username: ctx.message.chat.username }, raw: true }).then((result) => {
        if (result) {
            ctx.reply('–í—ã —É–∂–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –æ–ø—Ä–æ—Å!')
        } else {
            ctx.reply(
                `–ü—Ä–∏–≤–µ—Ç! –ù–∞ —Å–≤—è–∑–∏ –¶–µ–Ω—Ç—Ä –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.\n 
        –ù–∞—à–∞ –∫–æ–º–ø–∞–Ω–∏—è —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è, –º–µ–Ω—è—é—Ç—Å—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –≤–º–µ—Å—Ç–µ —Å –Ω–∏–º–∏ –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–æ–¥—É–∫—Ç. –ê —Ç–∞–∫ –∫–∞–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—Å—ë –±–æ–ª—å—à–µ, —Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –≤–æ–≤—Ä–µ–º—è –ø–æ–ª—É—á–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –∏ —Å–ª—ã—à–∞—Ç—å –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤!\n
        –° –ø–æ–º–æ—â—å—é —ç—Ç–æ–≥–æ –æ–ø—Ä–æ—Å–Ω–∏–∫–∞ –º—ã —Ö–æ—Ç–∏–º —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ç–∞—Ä–∏—Ñ–∞—Ö/—É—Å–ª—É–≥–∞—Ö, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π –∏–∑ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±—ã–ª –≤ –∫—É—Ä—Å–µ —Å–æ–±—ã—Ç–∏–π, –∞ –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞–ª–∏ —Ç–æ–ª—å–∫–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏!\n
        –û–±–µ—â–∞–µ–º, —á—Ç–æ –æ–ø—Ä–æ—Å –∑–∞–π–º—ë—Ç –Ω–µ –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç, –∑–∞—Ç–æ —Ç–æ—á–Ω–æ –ø–æ–º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å –Ω–∞—à—É —Ä–∞–±–æ—Ç—É –µ—â–µ –ª—É—á—à–µ —Å —Ç–≤–æ–µ–π –ø–æ–º–æ—â—å—é!\n
        `,
                {
                    reply_markup: {
                        keyboard: [[{ text: '–ù–∞—á–∞—Ç—å' }]],
                        resize_keyboard: true,
                        one_time_keyboard: true,
                    },
                }
            )
            ctx.session.user = {}
            ctx.session.user.username = ctx.message.chat.username
        }
    })
})

bot.hears(/–ù–∞—á–∞—Ç—å/, (ctx) => {
    ctx.reply('–ü–æ–µ—Ö–∞–ª–∏! üòâ')
    ctx.reply(
        '–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –§–ò–û –∑–∞–ø–æ–ª–Ω—è—Ç—å –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ ‚Äì —ç—Ç–æ –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ —Å–≤—è–∑–∞—Ç—å—Å—è —Å —Ç–æ–±–æ–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —á—Ç–æ-—Ç–æ —É—Ç–æ—á–Ω–∏—Ç—å.'
    )
    ctx.scene.enter('cdps')
})
bot.launch()
